# 社区论坛项目需求文档

> 项目名称：社区论坛系统
> 版本号：v1.0
> 编制日期：2026年2月
> 文档状态：正式发布

---

## 第一章 项目概述

### 1.1 项目背景与目标

社区论坛系统是一个面向互联网用户的在线交流平台，旨在为用户提供一个分享知识、交流经验、结识朋友的虚拟社区空间。本项目采用现代化的前后端分离架构设计，充分考虑了系统的可扩展性、可维护性和高性能需求。项目定位于中小型社区应用场景，预计支持数千至数万活跃用户的并发访问需求。

项目的核心价值主张在于构建一个功能完善、体验流畅、用户友好的在线社区平台。通过提供发帖回帖、版块分类、内容搜索、用户互动等核心功能，满足用户的信息获取、知识分享和社交需求。系统设计遵循模块化原则，各功能模块之间保持低耦合高内聚的特性，便于后续的功能扩展和技术升级。

从业务角度而言，本项目不仅是一个技术展示平台，更是一个真实运营的社区产品。因此，在功能设计时需要充分考虑用户的使用习惯、内容审核的需求、以及社区运营管理的便利性。系统需要提供完善的内容管理机制，确保社区内容的质量和合规性，同时为用户提供良好的互动体验。

### 1.2 技术架构概述

本项目采用成熟的前后端分离架构，前端使用Vue 3生态系统构建响应式单页应用，后端基于Node.js的Express框架提供RESTful API服务，数据存储采用MySQL关系型数据库，缓存层使用Redis提升系统性能，整体架构设计遵循行业最佳实践。

前端技术选型方面，项目基于Vue 3框架采用Composition API和TypeScript进行开发，充分利用Vue 3的响应式系统和组合式函数特性实现高效的组件逻辑复用。构建工具选用Vite 5.x，其基于ES模块的开发服务器能够提供极速的冷启动和热更新体验。路由管理采用Vue Router 4.x，通过动态路由和路由守卫实现页面的权限控制。状态管理使用Pinia 2.x，其简洁的API设计和良好的TypeScript支持使其成为Vue 3生态的首选状态管理方案。UI组件库选用Element Plus 2.5.x，提供了丰富的预制组件加速界面开发。HTTP请求封装采用Axios 1.6.x，配合请求拦截器和响应拦截器实现统一的错误处理和认证管理。富文本编辑器集成WangEditor 5.x，支持图片上传、格式设置等常用功能。样式处理采用Sass预处理器，通过变量和混入实现样式的复用和主题定制。

后端技术选型方面，项目基于Node.js 18.x以上版本运行，采用Express 4.x作为Web框架，其简洁的中间件设计使得请求处理流程清晰可控。ORM层选用Sequelize 6.x，通过模型定义和关联配置实现数据库操作的对象化，降低SQL编写复杂度的同时保证代码的可维护性。数据库驱动采用mysql2 3.x，提供高性能的MySQL连接支持。缓存层集成Redis 4.x，用于存储会话信息、热点数据和临时状态。身份认证采用JWT（JSON Web Token）标准，通过accessToken和refreshToken的双令牌机制实现安全的无状态认证。密码加密使用bcryptjs 5.x，采用bcrypt算法进行安全的密码哈希存储。文件上传采用multer中间件，支持多类型文件的上传和大小限制。安全增强方面，项目集成了helmet中间件设置HTTP安全头、express-rate-limit实现API限流、以及DOMPurify进行XSS攻击防护。

### 1.3 项目目录结构

```
forum-project/
├── backend/                      # Node.js后端项目
│   ├── src/
│   │   ├── config/              # 配置文件目录
│   │   │   ├── database.ts      # Sequelize数据库配置
│   │   │   ├── redis.ts         # Redis缓存配置
│   │   │   ├── jwt.ts           # JWT认证配置
│   │   │   ├── upload.ts        # 文件上传配置
│   │   │   └── app.ts           # 应用配置
│   │   ├── controllers/         # 控制器层
│   │   │   └── user.controller.ts
│   │   ├── services/            # 业务逻辑层
│   │   │   └── user.service.ts
│   │   ├── models/              # 数据模型层
│   │   │   ├── index.ts         # 模型入口
│   │   │   ├── user.model.ts
│   │   │   ├── post.model.ts
│   │   │   ├── category.model.ts
│   │   │   ├── comment.model.ts
│   │   │   ├── tag.model.ts
│   │   │   ├── post-tag.model.ts
│   │   │   ├── user-follow.model.ts
│   │   │   ├── post-like.model.ts
│   │   │   ├── favorite.model.ts
│   │   │   ├── attachment.model.ts
│   │   │   ├── notification.model.ts
│   │   │   ├── message.model.ts
│   │   │   └── operation-log.model.ts
│   │   ├── routes/              # 路由定义
│   │   │   ├── index.ts
│   │   │   └── user.routes.ts
│   │   ├── middlewares/         # 中间件
│   │   │   ├── auth.middleware.ts
│   │   │   └── error.middleware.ts
│   │   ├── utils/               # 工具函数
│   │   │   ├── response.ts
│   │   │   ├── crypto.ts
│   │   │   ├── token.ts
│   │   │   ├── logger.ts
│   │   │   └── validator.ts
│   │   ├── types/               # TypeScript类型定义
│   │   │   ├── express.d.ts
│   │   │   ├── user.d.ts
│   │   │   └── api.d.ts
│   │   ├── database/            # 数据库脚本
│   │   │   ├── migrations/
│   │   │   └── seeders/
│   │   ├── jobs/                # 队列任务
│   │   │   ├── email.job.ts
│   │   │   └── notification.job.ts
│   │   ├── app.ts               # Express应用入口
│   │   └── server.ts            # 服务启动入口
│   ├── tests/                   # 测试文件
│   │   ├── unit/
│   │   ├── integration/
│   │   └── e2e/
│   ├── uploads/                 # 上传文件目录
│   ├── logs/                    # 日志目录
│   ├── .env                     # 环境变量文件
│   ├── .env.example             # 环境变量示例
│   ├── tsconfig.json            # TypeScript配置
│   ├── jest.config.js           # Jest测试配置
│   └── package.json
│
├── frontend/                    # Vue 3前端项目
│   ├── public/                  # 静态资源
│   │   └── favicon.ico
│   ├── src/
│   │   ├── api/                 # API接口封装
│   │   │   ├── index.ts
│   │   │   └── user.ts
│   │   ├── components/          # 公共组件
│   │   │   ├── common/
│   │   │   │   ├── Header.vue
│   │   │   │   ├── Footer.vue
│   │   │   │   └── Sidebar.vue
│   │   │   ├── editor/
│   │   │   │   └── RichEditor.vue
│   │   │   ├── post/
│   │   │   │   ├── PostCard.vue
│   │   │   │   ├── PostList.vue
│   │   │   │   └── PostDetail.vue
│   │   │   └── comment/
│   │   │       ├── CommentList.vue
│   │   │       └── CommentItem.vue
│   │   ├── views/               # 页面视图
│   │   │   ├── home/
│   │   │   │   └── Index.vue
│   │   │   ├── post/
│   │   │   │   ├── List.vue
│   │   │   │   ├── Detail.vue
│   │   │   │   └── Create.vue
│   │   │   ├── user/
│   │   │   │   ├── Login.vue
│   │   │   │   ├── Register.vue
│   │   │   │   ├── Profile.vue
│   │   │   │   └── Settings.vue
│   │   │   ├── category/
│   │   │   │   └── Index.vue
│   │   │   ├── notification/
│   │   │   │   └── Index.vue
│   │   │   ├── message/
│   │   │   │   └── Index.vue
│   │   │   └── admin/
│   │   │       ├── Dashboard.vue
│   │   │       ├── Users.vue
│   │   │       ├── Posts.vue
│   │   │       └── Categories.vue
│   │   ├── stores/              # Pinia状态管理
│   │   │   ├── user.ts
│   │   │   ├── post.ts
│   │   │   └── app.ts
│   │   ├── router/              # 路由配置
│   │   │   └── index.ts
│   │   ├── utils/               # 工具函数
│   │   │   ├── request.ts
│   │   │   ├── storage.ts
│   │   │   ├── format.ts
│   │   │   └── validate.ts
│   │   ├── hooks/               # 组合式函数
│   │   │   ├── useAuth.ts
│   │   │   ├── usePost.ts
│   │   │   └── useUser.ts
│   │   ├── types/               # TypeScript类型定义
│   │   │   ├── user.d.ts
│   │   │   ├── post.d.ts
│   │   │   └── api.d.ts
│   │   ├── styles/              # 全局样式
│   │   │   ├── variables.scss
│   │   │   ├── mixins.scss
│   │   │   └── global.scss
│   │   ├── App.vue              # 根组件
│   │   └── main.ts              # 应用入口
│   ├── index.html
│   ├── vite.config.ts           # Vite构建配置
│   ├── tsconfig.json            # TypeScript配置
│   └── package.json
│
├── database/                    # 数据库相关文件
│   ├── init.sql                 # 数据库初始化脚本
│   ├── migrations/              # 数据库迁移文件
│   └── seeders/                 # 种子数据文件
│
├── docs/                        # 项目文档
│   ├── REQUIREMENTS.md          # 需求文档
│   ├── API.md                   # API接口文档
│   ├── DEVELOPMENT.md           # 开发指南
│   └── DEPLOY.md                # 部署文档
│
├── logs/                        # 日志文件目录
├── uploads/                     # 上传文件目录
├── README.md                    # 项目说明
├── DEVELOPMENT_GUIDE.md         # 开发指南
└── .gitignore                   # Git忽略配置
```

---

## 第二章 当前实现状态分析

### 2.1 项目整体进度概览

根据代码库分析结果，本项目目前处于第一阶段完成、第二阶段开发中的状态。项目整体进度按照既定的五个阶段进行规划，现已完成基础架构搭建和用户认证系统的开发工作，正在进行内容系统（帖子、评论、版块）的开发工作。

从代码实现角度来看，前端项目已完成核心页面的基础框架搭建，包括首页、登录页、注册页、用户设置页等主要页面组件。页面布局采用响应式设计，能够适配不同尺寸的屏幕设备。后端项目已完成用户认证相关的完整功能实现，包括用户注册、登录、信息获取与更新等核心接口。数据库模型层已完成全部13个数据模型的设计和实现，模型之间的关联关系也已正确配置。

项目的技术债务方面，目前主要存在以下需要完善的地方：前端部分页面组件的数据交互尚未与后端API对接完成，部分组件使用模拟数据进行展示；后端部分功能模块（帖子、评论、版块等）的业务逻辑尚未完全实现；数据库初始化脚本和种子数据尚未创建；前端通用组件（如Header、Footer、富文本编辑器等）尚未完整实现。

### 2.2 后端实现状态详述

后端项目已完成用户认证系统的完整实现，这是项目第一阶段的核心成果。用户认证系统包含用户注册、用户登录、获取当前用户信息、获取指定用户信息、更新当前用户信息等五个核心接口，所有接口均按照RESTful规范设计，并通过JWT中间件实现身份认证功能。

用户控制器（user.controller.ts）实现了完整的请求处理逻辑，包括参数验证、业务逻辑调用、响应格式封装等功能。控制器层采用asyncHandler包装器统一处理异步操作中的异常，确保错误能够被正确捕获和传递。控制器与业务逻辑层分离，通过调用userService提供的方法完成具体的业务操作。

用户服务层（user.service.ts）实现了用户相关的所有业务逻辑，包括用户注册时的唯一性检查（邮箱和用户名）、密码加密存储、用户登录时的凭证验证、Token生成与验证、以及用户信息的更新操作。服务层方法返回的数据经过处理，确保敏感信息（如密码）不会被暴露给上层。

用户模型（user.model.ts）完整定义了用户数据表的结构，包含用户名、邮箱、密码、昵称、头像、个人简介、角色、状态、声望值、发帖数、评论数、最后登录时间等字段。模型采用TypeScript泛型定义输入输出类型，确保类型安全。模型配置了beforeCreate和beforeUpdate钩子函数，在创建和更新用户时自动进行密码加密处理。模型还定义了comparePassword方法用于密码验证，以及toJSON方法用于序列化时排除敏感字段。

数据库模型层已完成全部13个数据模型的定义，包括用户（User）、帖子（Post）、版块（Category）、评论（Comment）、标签（Tag）、帖子标签关联（PostTag）、用户关注（UserFollow）、帖子点赞（PostLike）、收藏（Favorite）、附件（Attachment）、通知（Notification）、私信（Message）、操作日志（OperationLog）。所有模型之间的关联关系已在index.ts文件中统一配置，包括一对一、一对多、多对多等关联类型。

中间件层已完成身份认证中间件（auth.middleware.ts）和错误处理中间件（error.middleware.ts）的实现。身份认证中间件从请求头中提取JWT Token，验证Token的有效性，并将用户信息注入到请求对象中供后续处理使用。错误处理中间件捕获请求处理过程中的异常，统一格式化为错误响应返回给客户端。

路由层已完成用户路由（user.routes.ts）的定义，采用Express Router进行模块化路由管理。路由分为公开接口和需认证接口两类，公开接口包括注册、登录、获取指定用户信息，需认证接口包括获取当前用户信息和更新当前用户信息。

环境配置方面，项目已在backend/.env文件中配置了完整的运行参数，包括应用配置（环境、端口、API前缀）、数据库配置（主机、端口、名称、用户名、密码、连接池）、Redis配置（主机、端口、密码）、JWT配置（密钥、过期时间）、文件上传配置（大小限制、目录、URL）、日志配置（级别、目录）等。

### 2.3 前端实现状态详述

前端项目已完成基础页面框架的搭建，包括首页、登录页、注册页、用户设置页、发帖页、帖子列表页、帖子详情页、版块页等核心页面的Vue组件。页面组件采用Vue 3的Composition API和TypeScript进行开发，使用<script setup>语法糖简化组件定义。

首页组件（home/Index.vue）已完成完整的UI实现，包含欢迎区、热门帖子列表、最新帖子列表、热门版块列表、社区公告等模块。页面采用Element Plus的el-row和el-col组件进行响应式布局，通过el-card组件实现内容卡片化展示。目前页面中的热门帖子和版块数据使用模拟数据展示，尚未与后端API对接。

登录页组件（user/Login.vue）已完成完整的表单实现，包括邮箱输入框、密码输入框（带显示/隐藏切换）、记住我复选框、忘记密码链接、登录按钮、注册链接等元素。表单采用Element Plus的el-form组件实现，配合el-form-item进行表单验证配置。登录逻辑已与用户状态存储（userStore）对接，能够正确调用登录接口并处理登录结果。表单验证规则包括邮箱格式验证、密码长度验证等。

注册页组件（user/Register.vue）已完成完整的表单实现，包括用户名输入框、邮箱输入框、密码输入框、确认密码输入框、昵称输入框、注册按钮、登录链接等元素。表单验证规则包括用户名格式验证（3-50字符，仅字母数字下划线）、邮箱格式验证、密码长度验证（至少6位）、两次密码一致性验证等。

用户设置页组件（user/Settings.vue）已完成基础框架搭建，目前仅包含页面骨架，尚未实现具体的设置功能。

发帖页组件（post/Create.vue）已完成基础框架搭建，包含页面标题和发帖按钮，尚未实现富文本编辑器、表单验证、提交逻辑等功能。

帖子列表页组件（post/List.vue）已完成基础框架搭建，页面提示"帖子列表功能开发中"，尚未实现帖子列表展示和筛选功能。

帖子详情页组件（post/Detail.vue）已完成基础框架搭建，页面提示"帖子详情功能开发中"，尚未实现帖子内容展示、评论列表、互动功能等。

版块页组件（category/Index.vue）已完成基础框架搭建，页面提示"版块功能开发中"，尚未实现版块列表和版块帖子展示功能。

前端API封装方面，已创建api/index.ts和api/user.ts文件，其中user.ts封装了用户相关的HTTP请求方法，包括登录、注册、获取当前用户、获取用户信息、更新用户信息等。API封装采用Axios实例，配置了基础URL和请求头处理。

前端状态管理方面，已创建stores/user.ts文件，使用Pinia定义用户状态存储，包含用户信息、登录状态、Token等状态变量，以及登录、登出、获取用户信息等Action方法。状态存储实现了持久化存储，能够在页面刷新时保持用户登录状态。

### 2.4 数据库模型实现状态

项目已完成全部13个数据模型的Sequelize定义，模型结构与DEVELOPMENT_GUIDE.md文档中的设计保持一致。各模型的字段定义完整，包含字段类型、约束条件、默认值、注释等配置。模型之间的关联关系已正确配置，包括外键约束和别名设置。

用户模型（User）是项目中最完整的模型，包含13个字段：id（主键）、username（用户名，唯一）、email（邮箱，唯一）、password（密码）、nickname（昵称）、avatar（头像）、bio（个人简介）、role（角色，枚举值user/moderator/admin）、status（状态，枚举值active/inactive/banned）、reputation（声望值）、post_count（发帖数）、comment_count（评论数）、last_login_at（最后登录时间）。模型配置了用户名格式验证（正则表达式/^[a-zA-Z0-9_]+$/）、邮箱格式验证、密码加密钩子等。

帖子模型（Post）已完成定义，包含字段：id（主键）、user_id（作者ID，外键）、category_id（版块ID，外键）、title（标题）、content（内容）、content_type（内容类型）、excerpt（摘要）、cover_image（封面图）、views（浏览量）、likes（点赞数）、comments_count（评论数）、favorites_count（收藏数）、is_top（是否置顶）、is_essence（是否精华）、status（状态）、published_at（发布时间）、last_comment_at（最后评论时间）。模型配置了全文索引用于搜索优化。

版块模型（Category）已完成定义，包含字段：id（主键）、name（版块名称）、description（版块描述）、icon（版块图标）、color（主题色）、sort_order（排序）、parent_id（父版块ID，自关联）、moderator_id（版主ID，外键）、rules（版块规则）、post_count（帖子数量）、is_active（是否启用）。模型支持多级版块结构，通过自关联实现。

评论模型（Comment）已完成定义，包含字段：id（主键）、post_id（帖子ID，外键）、user_id（用户ID，外键）、parent_id（父评论ID，自关联）、root_id（根评论ID，自关联）、content（内容）、likes（点赞数）、is_deleted（是否删除）。模型支持多级嵌套评论结构，通过parent_id和root_id两个外键实现。

标签模型（Tag）已完成定义，包含字段：id（主键）、name（标签名，唯一）、description（描述）、color（颜色）、icon（图标）、post_count（帖子数量）。

其他关联模型（PostTag、UserFollow、PostLike、Favorite、Attachment、Notification、Message、OperationLog）均已完成定义，结构与设计文档一致。

---

## 第三章 功能需求规格

### 3.1 用户系统需求

用户系统是社区论坛的基础模块，承担着用户身份管理、认证授权、个人信息维护等核心功能。用户系统的设计需要充分考虑用户体验和安全性，在提供便捷的注册登录功能的同时，确保用户数据的安全性和隐私保护。

用户注册功能需要支持新用户通过邮箱创建账号。注册流程中，系统需要验证用户名的唯一性和格式规范性（3-50字符，仅允许字母、数字、下划线），验证邮箱的有效性和唯一性，验证密码的强度（至少6位字符）。验证通过后，系统将用户信息存入数据库，密码经过bcrypt算法加密存储，同时生成JWT Token返回给用户。注册成功后，用户可以直接登录进入系统。

用户登录功能需要支持已注册用户通过邮箱和密码登录系统。登录流程中，系统需要根据邮箱查找用户，验证用户状态（未封禁），验证密码是否匹配。登录成功后，系统更新用户的最后登录时间，生成新的JWT Token（包含用户ID、用户名、邮箱、角色等信息）返回给客户端。登录接口需要实现限流机制，防止暴力破解攻击，建议配置为每小时最多5次失败尝试。

获取用户信息功能需要支持获取当前登录用户的详细信息和获取指定用户的基本信息。获取当前用户需要通过JWT Token认证，从Token中解析用户ID，查询数据库返回完整用户信息（排除密码字段）。获取指定用户通过URL参数传递用户ID，查询返回用户的基本公开信息（排除密码等敏感字段）。

更新用户信息功能需要支持当前登录用户修改个人资料。可修改字段包括昵称、个人简介、头像URL。系统需要验证昵称长度不超过50字符，验证头像URL格式正确。用户名和邮箱属于用户身份标识，暂不允许用户自主修改。更新操作需要验证用户登录状态，通过认证中间件获取当前用户ID。

用户角色分为三种：普通用户（user）、版主（moderator）、管理员（admin）。普通用户可以发帖、回帖、点赞、收藏、关注等基本操作；版主可以管理所属版块的内容，包括加精、置顶、删除等操作；管理员拥有最高权限，可以管理所有用户、内容和系统配置。角色权限的控制通过JWT Token中携带的角色信息和后端的权限中间件实现。

### 3.2 内容系统需求

内容系统是社区论坛的核心模块，提供帖子发布、浏览、编辑、删除，以及评论发布、浏览、回复等功能。内容系统的设计需要充分考虑内容的质量控制、用户体验和系统性能。

帖子发布功能需要支持用户创建新帖子。发帖页面需要集成富文本编辑器，支持标题、正文、版块选择、标签选择、封面图上传等输入项。标题长度限制为5-100字符，正文内容至少10字符。版块选择从已有版块列表中选择，标签支持多选或自定义输入。封面图上传支持JPEG、PNG、GIF格式，单张图片大小限制为2MB。上传的图片由后端处理后返回访问URL，前端将URL保存到表单数据中。发帖接口需要验证用户登录状态，验证所有输入字段的有效性，验证版块和标签的有效性。发布成功后，系统更新版块的帖子计数，返回帖子详情页的跳转地址。

帖子列表功能需要支持分页展示帖子列表。列表接口支持多种筛选条件：按版块ID筛选、按标签筛选、按用户ID筛选、按关键词搜索。排序方式支持按发布时间（最新/最早）、按最后评论时间、按浏览量、按点赞数等。列表项展示信息包括帖子标题、作者信息、版块名称、发布时间、浏览量、点赞数、评论数等。置顶帖子需要在列表中优先显示，精华帖子可以通过特殊标识区分。分页参数包括页码（page，默认1）和每页数量（size，默认20，最大100）。

帖子详情功能需要支持查看单个帖子的完整内容。详情页展示信息包括帖子标题、作者信息（头像、昵称、发帖数）、发布时间、浏览量、正文内容、标签列表、点赞数、收藏数、评论列表等。帖子正文以富文本形式渲染展示，支持图片、链接、代码块等格式。详情页需要实时更新浏览量，同时提供点赞、收藏、评论等交互入口。

帖子编辑功能需要支持帖子作者修改已发布的帖子内容。编辑页面预加载帖子当前数据，用户可以修改标题、正文、标签、封面图等信息。编辑限制包括：只能编辑自己发布的帖子，帖子状态为已发布时可以编辑，帖子状态为待审核或已删除时不能编辑。编辑成功后，系统更新帖子的最后修改时间，帖子在列表中的排序按原始发布时间不变。

帖子删除功能需要支持帖子作者删除自己发布的帖子，或管理员删除任何帖子。删除操作采用软删除机制，更新帖子的status字段为deleted，而不是直接从数据库删除。软删除的帖子在列表查询时默认不展示，但在管理后台可以查看和恢复。删除帖子时，系统同时删除该帖子的所有评论、附件、关联记录，更新版块和用户的统计计数。

评论功能需要支持用户对帖子发表评论，以及对评论进行回复。评论接口支持嵌套结构，每条评论可以包含若干回复。评论内容支持纯文本，长度限制为1-1000字符。评论列表按楼层顺序展示，回复通过缩进或@提及与原评论关联。评论统计数量实时更新，删除评论采用软删除机制。

版块管理功能需要支持查看版块列表和版块详情。版块列表展示所有启用的版块，包括版块名称、描述、图标、帖子数量等信息。版块详情展示单个版块的详细信息，包括版块规则、版主信息、最新帖子列表等。版块支持多级分类，通过父版块ID实现层级结构。

### 3.3 互动系统需求

互动系统是提升用户粘性和社区活跃度的关键模块，提供点赞、收藏、关注、通知等社交功能。互动系统的设计需要注重实时性和交互体验。

点赞功能需要支持用户对帖子和评论进行点赞或取消点赞。点赞记录存储在独立的关联表中，通过用户ID和目标ID（帖子ID或评论ID）联合主键防止重复点赞。点赞状态需要实时更新，点赞成功后目标对象的点赞计数加1，取消点赞后计数减1。前端展示点赞按钮的选中状态，用户可以直观了解自己是否已点赞。点赞操作需要验证用户登录状态，未登录用户点击点赞时引导至登录页面。

收藏功能需要支持用户收藏感兴趣的帖子。收藏记录存储在favorites表中，支持按收藏夹分组（默认收藏夹名为"默认收藏夹"）。用户可以创建多个收藏夹对收藏内容进行分类管理。收藏列表展示用户收藏的所有帖子，支持按收藏时间排序。取消收藏后，帖子的收藏计数减1。收藏功能需要验证用户登录状态。

关注功能需要支持用户关注其他用户。关注记录存储在user_follows表中，通过follower_id（关注者）和following_id（被关注者）联合主键防止重复关注。用户个人主页展示关注数和粉丝数，以及关注列表和粉丝列表入口。关注状态需要实时更新，关注成功后双方的用户关系建立。取消关注后，解除用户之间的关注关系。关注功能需要验证用户登录状态，不能关注自己。

通知功能需要支持系统向用户推送各类通知。通知类型包括：系统通知（管理员发布的公告）、评论通知（有人评论了你的帖子）、回复通知（有人回复了你的评论）、点赞通知（有人点赞了你的帖子或评论）、关注通知（有人关注了你）、@提及通知（在评论中@了你）。每条通知包含标题、内容、关联目标、是否已读状态。用户可以查看通知列表，标记单条或全部通知为已读。未读通知数量在页面顶部展示角标提示。通知触发时机包括：发表评论时通知帖子作者、回复评论时通知原评论作者、点赞帖子或评论时通知作者、关注用户时通知被关注者。

### 3.4 私信系统需求

私信功能需要支持用户之间的一对一私密交流。私信属于私密通信，内容仅对发送者和接收者可见，不公开展示。

发送私信功能需要支持用户向其他用户发送私信。发送界面需要选择接收用户（通过搜索或推荐选择），输入私信内容（支持纯文本，限制1-2000字符）。发送成功后，系统创建私信记录，接收者的未读私信计数加1。私信发送者可以查看自己的发送记录。发送私信需要验证登录状态，接收者不能是发送者自己。

接收私信功能需要支持用户查看收到的私信。私信列表按会话分组，展示每个会话的最后一条消息和未读消息数量。点击会话进入详情页，展示与该用户的所有私信往来。接收者可以查看私信内容，标记为已读。未读私信数量在页面顶部展示提示。

私信管理功能需要支持用户删除不需要的私信。删除操作仅删除当前用户视角的记录，不影响对方的查看。删除支持单条删除或清空会话。举报功能用于处理骚扰或违规私信，用户可以举报疑似违规的私信，举报内容由管理员审核处理。黑名单功能用于屏蔽不想接收私信的用户，被拉黑的用户无法向该用户发送私信。

### 3.5 搜索系统需求

搜索功能需要支持用户快速查找感兴趣的内容。搜索范围包括帖子标题、帖子内容、用户名等。

全文搜索功能需要支持用户输入关键词搜索相关帖子。搜索接口支持分页参数，支持按版块或时间范围筛选。搜索结果按相关度或时间排序，展示帖子标题、摘要、作者、版块、发布时间等信息。搜索关键词高亮显示在结果中。搜索接口需要处理停用词、模糊匹配、相关度计算等技术问题。

搜索建议功能需要在用户输入搜索关键词时提供实时建议。建议列表展示热门搜索词、相关标签、热门帖子等。搜索建议需要本地防抖处理，避免频繁请求后端。点击建议项直接跳转到对应页面或执行搜索。

热门搜索功能需要展示近期搜索热度较高的关键词。热门搜索列表定期更新，展示在搜索页面或首页侧边栏。热门搜索数据来源于搜索日志的统计分析。

### 3.6 管理系统需求

管理后台用于社区运营人员管理用户、内容和系统配置。管理后台前端页面独立于主站，采用单独的路由和布局，需要管理员权限才能访问。

用户管理功能需要支持管理员查看和管理所有用户。用户列表展示用户ID、用户名、邮箱、昵称、角色、状态、注册时间、最后登录时间等信息。管理员可以搜索用户、按状态筛选、按角色筛选。管理员可以编辑用户信息、修改用户角色、封禁/解封用户、删除用户。封禁操作更新用户状态为banned，被封禁用户无法登录和操作。

内容审核功能需要支持管理员审核用户发布的待审内容。审核列表展示待审核的帖子和评论，包含举报内容的优先处理。审核操作包括通过（内容状态更新为已发布）、拒绝（内容状态更新为 rejected，需填写拒绝原因）、删除（软删除内容）。举报处理功能展示用户举报的内容记录，管理员审核后执行相应操作。

版块管理功能需要支持管理员管理社区版块。版块列表展示所有版块，包括启用和禁用的版块。管理员可以创建新版块（填写名称、描述、图标、颜色、排序、父版块等）、编辑已有版块、设置版主、删除版块（删除前需转移或删除版块下所有帖子）。

数据统计功能需要支持管理员查看社区运营数据。统计维度包括：用户统计（每日新增用户数、活跃用户数、累计用户数等）、内容统计（每日新增帖子数、评论数、累计帖子数等）、互动统计（每日点赞数、收藏数、关注数等）。统计数据支持按时间范围查询，支持图表可视化展示。统计数据来源于operation_logs表的记录分析。

---

## 第四章 API接口设计

### 4.1 接口规范

项目API遵循RESTful设计规范，采用JSON格式进行数据交换，字符编码为UTF-8，时间格式遵循ISO 8601标准（YYYY-MM-DDTHH:mm:ssZ）。

API基础URL为`http://localhost:3000/api/v1`，生产环境替换为实际域名。请求头需要设置Content-Type为application/json，认证接口需要在Authorization头中携带Bearer Token。

统一响应格式定义如下：成功响应包含code（状态码，200表示成功）、message（状态描述）、data（响应数据）、timestamp（响应时间戳）；错误响应包含code（错误码）、message（错误描述）、data（null）、timestamp（响应时间戳）。

HTTP状态码使用规范：200表示请求成功、201表示创建成功、204表示删除成功、400表示请求参数错误、401表示未授权或Token无效、403表示禁止访问（无权限）、404表示资源不存在、409表示资源冲突（如用户名已存在）、422表示验证失败、429表示请求过于频繁、500表示服务器内部错误。

### 4.2 已实现接口

用户认证模块已实现以下接口：

**POST /api/v1/users/register - 用户注册**
请求体包含username（用户名，3-50字符）、email（邮箱）、password（密码，至少6位）、nickname（昵称，可选）。注册成功后返回201状态码，响应数据包含user对象（排除password字段）和accessToken、refreshToken令牌。

**POST /api/v1/users/login - 用户登录**
请求体包含email（邮箱）、password（密码）。登录成功后返回200状态码，响应数据包含user对象和accessToken、refreshToken令牌。登录失败（用户不存在、密码错误、账号封禁）返回相应错误码和错误信息。

**GET /api/v1/users/:id - 获取用户信息**
路径参数id为用户ID。返回200状态码，响应数据为用户公开信息（排除password字段）。

**GET /api/v1/users/me - 获取当前用户**
需要在Authorization头中携带有效的Bearer Token。返回200状态码，响应数据为当前登录用户的完整信息（排除password字段）。Token无效或过期返回401错误。

**PUT /api/v1/users/me - 更新当前用户**
需要在Authorization头中携带有效的Bearer Token。请求体包含nickname（昵称）、bio（个人简介）、avatar（头像URL）。更新成功后返回200状态码，响应数据为更新后的用户信息。Token无效或过期返回401错误。

### 4.3 待实现接口

帖子模块待实现以下接口：

**GET /api/v1/posts - 获取帖子列表**
查询参数包括page（页码，默认1）、size（每页数量，默认20，最大100）、category_id（版块ID）、tag（标签名）、user_id（用户ID）、sort（排序字段，支持created_at、updated_at、views、likes）、order（排序方向，支持asc、desc）。返回帖子列表数据，包含分页信息。

**GET /api/v1/posts/:id - 获取帖子详情**
路径参数id为帖子ID。返回帖子详情数据，包含作者信息、版块信息、标签列表、评论列表等。帖子浏览量加1。

**POST /api/v1/posts - 创建帖子**
需要在Authorization头中携带有效的Bearer Token。请求体包含title（标题）、content（内容）、category_id（版块ID）、tags（标签数组，可选）、cover_image（封面图URL，可选）。创建成功后返回201状态码，响应数据为新创建的帖子信息。

**PUT /api/v1/posts/:id - 更新帖子**
需要在Authorization头中携带有效的Bearer Token，且只能是帖子作者或管理员。请求体包含title、content、tags、cover_image等可更新字段。更新成功后返回200状态码。

**DELETE /api/v1/posts/:id - 删除帖子**
需要在Authorization头中携带有效的Bearer Token，且只能是帖子作者或管理员。采用软删除，更新帖子状态为deleted。删除成功后返回204状态码。

**POST /api/v1/posts/:id/like - 点赞帖子**
需要在Authorization头中携带有效的Bearer Token。成功点赞后返回200状态码，响应数据包含新的点赞数。

**DELETE /api/v1/posts/:id/like - 取消点赞**
需要在Authorization头中携带有效的Bearer Token。取消点赞后返回200状态码，响应数据包含新的点赞数。

**POST /api/v1/posts/:id/favorite - 收藏帖子**
需要在Authorization头中携带有效的Bearer Token。请求体可包含folder_name（收藏夹名称）。收藏成功后返回201状态码。

**DELETE /api/v1/posts/:id/favorite - 取消收藏**
需要在Authorization头中携带有效的Bearer Token。取消收藏成功后返回204状态码。

**GET /api/v1/posts/search - 搜索帖子**
查询参数包括q（搜索关键词）、page、size。支持按关键词搜索帖子标题和内容。

评论模块待实现以下接口：

**GET /api/v1/posts/:post_id/comments - 获取评论列表**
查询参数包括page、size。返回帖子的评论列表，支持嵌套结构展示。

**POST /api/v1/posts/:post_id/comments - 创建评论**
需要在Authorization头中携带有效的Bearer Token。请求体包含content（评论内容）、parent_id（父评论ID，可选，用于回复）。创建成功后返回201状态码。

**PUT /api/v1/comments/:id - 更新评论**
需要在Authorization头中携带有效的Bearer Token，且只能是评论作者。请求体包含content。更新成功后返回200状态码。

**DELETE /api/v1/comments/:id - 删除评论**
需要在Authorization头中携带有效的Bearer Token，且只能是评论作者或管理员。采用软删除。删除成功后返回204状态码。

**POST /api/v1/comments/:id/like - 点赞评论**
需要在Authorization头中携带有效的Bearer Token。点赞成功后返回200状态码。

版块模块待实现以下接口：

**GET /api/v1/categories - 获取版块列表**
返回所有启用的版块列表，包含版块基本信息。

**GET /api/v1/categories/:id - 获取版块详情**
返回指定版块的详细信息，包含版块规则、版主信息等。

**GET /api/v1/categories/:id/posts - 获取版块帖子**
查询参数包括page、size、sort、order。返回指定版块的帖子列表。

用户互动模块待实现以下接口：

**POST /api/v1/users/:id/follow - 关注用户**
需要在Authorization头中携带有效的Bearer Token。关注成功后返回201状态码。

**DELETE /api/v1/users/:id/follow - 取消关注**
需要在Authorization头中携带有效的Bearer Token。取消关注成功后返回204状态码。

**GET /api/v1/notifications - 获取通知列表**
需要在Authorization头中携带有效的Bearer Token。返回当前用户的通知列表，支持按类型筛选、按已读状态筛选。

**PUT /api/v1/notifications/:id/read - 标记通知已读**
需要在Authorization头中携带有效的Bearer Token。标记成功后返回200状态码。

**POST /api/v1/messages - 发送私信**
需要在Authorization头中携带有效的Bearer Token。请求体包含receiver_id（接收者ID）、content（私信内容）。发送成功后返回201状态码。

**GET /api/v1/messages - 获取私信列表**
需要在Authorization头中携带有效的Bearer Token。返回当前用户的私信会话列表或详情。

文件上传模块待实现以下接口：

**POST /api/v1/upload/image - 上传图片**
需要在Authorization头中携带有效的Bearer Token。请求体为multipart/form-data格式，包含file字段（图片文件）。支持JPEG、PNG、GIF格式，单文件大小限制为2MB。上传成功后返回201状态码，响应数据包含url（访问URL）、filename（文件名）、size（文件大小）。

---

## 第五章 开发计划建议

### 5.1 优先级排序

根据功能的重要性和依赖关系，将待开发功能划分为四个优先级。

**P0优先级（必须完成）** 是第二阶段的核心内容，包括：帖子CRUD完整实现（后端控制器、服务、路由、前端页面）、评论功能完整实现、版块API完整实现、帖子列表页面API对接、帖子详情页面API对接、富文本编辑器集成。这些功能是内容系统的基础，支撑用户的主要使用场景，必须优先完成。

**P1优先级（重要）** 是第三阶段的主要内容，包括：点赞/收藏功能（后端API和前端交互）、用户个人主页（Profile页面完善）、通知系统（后端API和前端展示）、关注系统、图片上传功能、搜索功能。这些功能增强用户互动和内容发现能力，提升用户体验。

**P2优先级（一般）** 是第四阶段的主要内容，包括：私信系统、管理后台（用户管理、内容审核、版块管理）、数据统计、操作日志。这些功能主要服务社区运营人员，是系统完整性的重要组成部分。

**P3优先级（可选）** 是第五阶段的主要内容，包括：Redis缓存集成、API性能优化、前端性能优化（懒加载、代码分割）、单元测试和集成测试覆盖率提升、生产环境部署文档。这些功能提升系统性能和可维护性，属于优化完善阶段。

### 5.2 阶段规划

**第一阶段：基础架构（已完成）**
本阶段完成了项目的基础架构搭建，包括：前端项目初始化（Vite + Vue 3 + TypeScript）、路由配置、状态管理配置、UI组件库集成、Axios请求封装；后端项目初始化（Express + TypeScript）、数据库配置（Sequelize + MySQL）、用户模型定义、JWT认证中间件、注册/登录API；用户认证系统完整实现、登录/注册页面完整实现。

**第二阶段：内容系统（当前进行中）**
本阶段的目标是实现发帖、评论核心功能。前端任务包括：富文本编辑器集成（WangEditor）、发帖页面完整功能、帖子列表页面API对接、帖子详情页面API对接、评论组件API对接、图片上传组件。后端任务包括：帖子模型API完整实现、评论模型API完整实现、版块模型API完整实现、文件上传服务、帖子搜索接口。数据库任务包括：创建帖子表、评论表、版块的迁移文件、建立表关联关系、添加全文搜索索引。

**第三阶段：互动功能（计划）**
本阶段的目标是实现点赞、收藏、关注等互动功能。前端任务包括：点赞/取消点赞功能交互、收藏/取消收藏功能交互、关注/取消关注功能交互、用户个人主页完善、通知中心前端展示。后端任务包括：点赞系统API、收藏系统API、关注系统API、通知系统API、用户统计信息API。数据库任务包括：创建点赞表、收藏表、关注表、通知表的迁移文件。

**第四阶段：管理后台（计划）**
本阶段的目标是开发管理后台，完善系统功能。前端任务包括：管理后台布局、用户管理页面、内容审核页面、版块管理页面、数据统计面板。后端任务包括：管理员权限中间件、用户管理API、内容审核API、数据统计API、操作日志记录。数据库任务包括：创建操作日志表迁移文件、添加管理员初始账号。

**第五阶段：优化部署（计划）**
本阶段的目标是性能优化、系统测试、部署上线。任务包括：Redis缓存集成、API性能优化、前端性能优化（懒加载、代码分割）、编写单元测试和集成测试、安全加固（XSS防护、SQL注入防护）、部署文档编写、生产环境部署。

### 5.3 开发规范

代码规范方面，前端采用Vue 3 Composition API，使用<script setup lang="ts>语法糖；组件使用PascalCase命名（如UserCard.vue）；变量和函数使用camelCase命名；样式使用SCSS，采用BEM命名规范。后端采用TypeScript，控制器层处理请求和响应，服务层处理业务逻辑，模型层定义数据结构；类使用PascalCase命名；接口使用PascalCase命名；函数和变量使用camelCase命名；常量使用SNAKE_UPPER_CASE命名。

Git工作流方面，采用main（生产分支）、develop（开发分支）、feature/*（功能分支）、hotfix/*（紧急修复分支）、release/*（发布分支）的分支策略。提交信息遵循Conventional Commits规范：feat表示新功能、fix表示修复bug、docs表示文档更新、style表示代码格式调整、refactor表示重构代码、test表示测试相关、chore表示构建/工具相关。

---

## 第六章 风险与注意事项

### 6.1 技术风险

富文本编辑器的XSS防护是本项目的重要安全风险点。由于帖子内容支持富文本格式，用户可以输入HTML代码、JavaScript脚本等，存在XSS攻击风险。解决方案包括：使用DOMPurify库对富文本内容进行消毒处理，移除危险的HTML标签和属性；配置内容安全策略（CSP）响应头；前端渲染时使用textContent而非innerHTML；后端存储前再次进行消毒处理。

大文件上传可能导致服务器资源耗尽和带宽浪费。解决方案包括：配置合理的文件大小限制（建议单文件2MB）；实现上传进度条和断点续传；使用对象存储服务（如阿里云OSS、腾讯云COS）存储上传文件；限制上传频率和并发数。

搜索功能在数据量大时可能出现性能问题。解决方案包括：初期使用MySQL的FULLTEXT索引实现简单搜索；数据量增长后考虑引入Elasticsearch；实现搜索缓存，减少重复查询；使用搜索结果分页，避免一次性返回大量数据。

高并发场景需要充分的性能优化。解决方案包括：使用Redis缓存热点数据；实现API接口限流；使用数据库连接池；考虑读写分离架构；使用消息队列处理异步任务。

### 6.2 安全风险

用户输入验证是防止注入攻击的关键。解决方案包括：所有用户输入必须进行验证和清理；使用Sequelize的参数化查询，禁止原始SQL拼接；实现统一的参数验证中间件；对特殊字符进行转义处理。

API权限控制需要严格执行。解决方案包括：实现完善的认证中间件；敏感操作需要重新验证身份；角色权限分级管理；操作日志记录关键操作。

敏感数据需要妥善保护。解决方案包括：密码必须加密存储（bcrypt）；Token使用安全的签名算法（HS256）；敏感数据不在URL参数中传递；实现完善的日志脱敏机制。

### 6.3 性能风险

数据库查询优化是性能提升的重点。解决方案包括：为常用查询字段添加索引；避免N+1查询问题，使用批量查询和预加载；合理使用数据库连接池；定期分析慢查询日志并进行优化。

前端性能优化提升用户体验。解决方案包括：路由懒加载，首屏快速加载；组件按需引入，减少包体积；图片懒加载和响应式图片；合理使用KeepAlive缓存组件状态。

API响应时间需要严格控制。解决方案包括：复杂查询使用异步处理；实现多级缓存策略；数据库查询结果缓存；API响应压缩传输。

---

## 附录A 数据库模型状态

### A.1 已完成模型清单

| 模型名称 | 中文名称 | 状态 | 说明 |
|---------|---------|------|------|
| User | 用户模型 | 已完成 | 完整实现，包含所有字段和验证 |
| Post | 帖子模型 | 已完成 | 字段完整，待API对接 |
| Category | 版块模型 | 已完成 | 字段完整，支持多级版块 |
| Comment | 评论模型 | 已完成 | 字段完整，支持嵌套评论 |
| Tag | 标签模型 | 已完成 | 字段完整 |
| PostTag | 帖子标签关联 | 已完成 | 多对多关联表 |
| UserFollow | 用户关注关联 | 已完成 | 多对多关联表 |
| PostLike | 帖子点赞关联 | 已完成 | 多对多关联表 |
| Favorite | 收藏关联 | 已完成 | 支持收藏夹分组 |
| Attachment | 附件模型 | 已完成 | 字段完整 |
| Notification | 通知模型 | 已完成 | 支持多种通知类型 |
| Message | 私信模型 | 已完成 | 字段完整 |
| OperationLog | 操作日志模型 | 已完成 | 字段完整 |

### A.2 待完善内容

数据库迁移文件尚未创建，需要为所有数据表创建Sequelize迁移文件。种子数据尚未创建，需要创建初始版块数据、初始管理员账号、测试数据等。数据库初始化脚本（init.sql）尚未创建，需要提供一键建库建表的SQL脚本。

---

## 附录B 前端组件状态

### B.1 已完成页面清单

| 页面路径 | 页面名称 | 状态 | 说明 |
|---------|---------|------|------|
| / | 首页 | 已完成 | 完整UI，模拟数据 |
| /login | 登录页 | 已完成 | 完整功能，API已对接 |
| /register | 注册页 | 已完成 | 完整功能 |
| /user/settings | 用户设置 | 框架完成 | 待实现具体功能 |
| /post/create | 发帖页 | 框架完成 | 待实现富文本编辑 |
| /posts | 帖子列表 | 框架完成 | 待API对接 |
| /post/:id | 帖子详情 | 框架完成 | 待API对接 |
| /category/:id | 版块页 | 框架完成 | 待API对接 |
| /user/:id | 用户主页 | 框架完成 | 待完善 |

### B.2 待创建组件清单

| 组件路径 | 组件名称 | 说明 |
|---------|---------|------|
| components/common/Header.vue | 顶部导航栏 | 全局导航、用户状态展示 |
| components/common/Footer.vue | 底部版权栏 | 版权信息、友链 |
| components/common/Sidebar.vue | 侧边栏 | 用户信息、快捷入口 |
| components/common/Pagination.vue | 分页组件 | 通用分页器 |
| components/editor/RichEditor.vue | 富文本编辑器 | 帖子内容编辑 |
| components/post/PostCard.vue | 帖子卡片 | 列表项展示 |
| components/post/PostList.vue | 帖子列表 | 列表容器组件 |
| components/post/PostDetail.vue | 帖子详情 | 详情页主体组件 |
| components/comment/CommentList.vue | 评论列表 | 评论容器组件 |
| components/comment/CommentItem.vue | 评论项 | 单条评论展示 |

---

## 附录C 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 版块 | Category | 帖子的分类容器，也称为论坛版块 |
| 帖子 | Post | 用户发布的文章内容 |
| 评论 | Comment | 用户对帖子或评论的回复 |
| 标签 | Tag | 用于标记帖子内容的关键词 |
| 置顶 | Top | 帖子在列表中固定显示在顶部 |
| 精华 | Essence | 优质帖子标记 |
| 声望 | Reputation | 用户的积分/等级指标 |
| JWT | JSON Web Token | 无状态身份认证令牌 |
| 软删除 | Soft Delete | 更新记录状态而非物理删除 |
| ORM | Object-Relational Mapping | 对象关系映射 |

---

> 文档编制：OpenCode AI Assistant
> 编制日期：2026年2月2日
> 版本历史：v1.0 - 初始版本
